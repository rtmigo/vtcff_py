# [vtcff](https://github.com/rtmigo/vtcff_py)

**This project is a draft üçè and is not intended to be used by anyone.**

The library is designed for transcoding between video formats with an emphasis
on maintaining quality and color depth in studio pipelines.

It generates arguments for `ffmpeg` ‚Äì the least intuitive command line tool ever
created.

# Install

```bash
$ pip3 install git+https://github.com/rtmigo/vtcff_py#egg=vtcff
```

# Basic example

```python3
import subprocess
from vtcff import FfmpegCommand, Scale, Speed, Transpose

cmd = FfmpegCommand()

cmd.src_file = '/path/to/source.mov'
cmd.dst_file = '/path/to/target.mov'

# set set some options
cmd.scale = Scale(-2, 1080)
cmd.speed = Speed.n2_superfast
cmd.transpose = Transpose.Clockwise

# run command
subprocess.check_call(list(cmd))
```

# Crop and scale

```python3
from vtcff import FfmpegCommand, Scale, Crop

# crop 10 pixels, then scale
a = FfmpegCommand()
a.crop = Crop(left=10)
a.scale = Scale(1920, 1080)

# scale, then crop 10 pixels
b = FfmpegCommand()
b.scale = Scale(1920, 1080)
b.crop = Crop(left=10)
```

# Scale proportionally

```python3
from vtcff import FfmpegCommand, Scale

cmd = FfmpegCommand()

# set height to 1080, automatically compute width 
cmd.scale = Scale(-1, 1080)

# set height to 1080, select the width as the closest factor 
# of two to the proportional size 
cmd.scale = Scale(-2, 1080)
```

# Change color range

```python3
from vtcff import FfmpegCommand

# use zscale (zimg) for color conversions
cmd = FfmpegCommand(use_zscale=True)

# Full/Data/PC range to Limited/Video/TV
cmd.src_range_full = True
cmd.dst_range_full = False

# rec.709 to rec.2020 
cmd.src_color_space = 'bt709'
cmd.dst_color_space = 'bt2020'
```

# Set arguments manually

Manual arguments override those generated by the object.

```python3
from vtcff import FfmpegCommand

cmd = FfmpegCommand()

# set arguments as string
cmd.override_video.string = "-vcodec libx265"
cmd.override_video.string += "-x265-params lossless=1"

# or as list
cmd.override_video.list = ["-vcodec", "libx265"]
cmd.override_video.list.extend(["-x265-params", "lossless=1"])

# video, audio, general - are three groups of manually set arguments
cmd.override_video.string = "-vcodec libx265"
cmd.override_audio.string = "-c:a aac -cutoff 18000 -b:a 128K"
cmd.override_general.string = "-movflags write_colr"

# so you can modify one of the groups without touching the others
cmd.override_video.string = "-vcodec prores_ks -profile:v 3"
```

# JPEG timelapse to ProRes

```python3
import subprocess
from vtcff import FfmpegCommand

# use zscale (zimg) for color conversions
cmd = FfmpegCommand(use_zscale=True)

cmd.src_file = '/my/timelapse/img_%04.jpg'
cmd.dst_file = '/videos/timelapse.mov'

cmd.src_fps = 29.97

cmd.override_video.string = "-vcodec prores_ks -profile:v 3"

# Full/Data/PC range to Limited/Video/TV
cmd.src_range_full = True
cmd.dst_range_full = False

# we will treat sRGB like Rec.709, 
# although it's a little sad
cmd.src_color_space = 'bt709'
cmd.dst_color_space = 'bt709'

# run command
subprocess.check_call(list(cmd))
```
